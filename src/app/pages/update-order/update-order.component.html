<section class="bg-white rounded-lg shadow border border-stone-200 p-5">
  <h1 class="text-xl font-semibold text-emerald-800">Actualización de orden</h1>

  <form
    [formGroup]="findForm"
    (ngSubmit)="find()"
    class="mt-4 grid grid-cols-1 gap-4 md:grid-cols-3"
  >
    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-slate-800">Buscar por número de paquete</label>
      <input
        class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-emerald-600 focus:ring-emerald-600"
        formControlName="packageNumber"
        placeholder="Ej. 1001"
      />
      <p
        class="mt-1 text-xs text-red-600"
        *ngIf="
          findForm.controls['packageNumber'].invalid && findForm.controls['packageNumber'].touched
        "
      >
        Obligatorio.
      </p>
    </div>
    <div class="flex items-end">
      <button
        class="inline-flex items-center rounded-md border border-emerald-700 text-emerald-800 bg-white hover:bg-stone-100 px-4 py-2 text-sm font-medium w-full focus:outline-none focus:ring-2 focus:ring-emerald-700 focus:ring-offset-2"
        type="submit"
      >
        Buscar
      </button>
    </div>
  </form>

  <div class="mt-6" *ngIf="order">
    <div class="bg-white rounded-lg shadow border border-stone-200 p-4">
      <p class="text-sm">
        <strong>Paquete:</strong> {{ order.packageNumber }} | <strong>Seguimiento:</strong>
        {{ order.trackingId }}
      </p>
      <p class="text-sm mt-1">
        <strong>Estado actual:</strong>
        <span
          class="inline-flex items-center rounded-full bg-stone-200 px-2.5 py-0.5 text-xs font-medium text-emerald-800"
          >{{ order.status }}</span
        >
      </p>
      <p class="text-xs text-slate-600 mt-1">
        <strong>Remitente:</strong> {{ order.senderName }} | <strong>Entrega:</strong>
        {{ order.address.street }}, Zona {{ order.address.zone }}, {{ order.address.municipality }},
        {{ order.address.department }}
      </p>
    </div>

    <form
      [formGroup]="updateForm"
      (ngSubmit)="submitUpdate()"
      class="mt-4 grid grid-cols-1 gap-4 md:grid-cols-3"
    >
      <div>
        <label class="block text-sm font-medium text-slate-800">Nuevo estado</label>
        <select
          class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-emerald-600 focus:ring-emerald-600"
          formControlName="state"
        >
          <option value="" disabled>Selecciona…</option>
          <option *ngFor="let s of allowed" [value]="s">{{ s }}</option>
        </select>
        <p
          class="mt-1 text-xs text-red-600"
          *ngIf="updateForm.controls['state'].invalid && updateForm.controls['state'].touched"
        >
          Selecciona un estado válido.
        </p>
      </div>

      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-slate-800">Comentario (20 a 40)</label>
        <input
          class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-emerald-600 focus:ring-emerald-600"
          formControlName="comment"
        />
        <div class="flex justify-end text-xs text-slate-500">
          <span>{{ updateForm.controls['comment'].value?.length || 0 }} / 40</span>
        </div>
        <p
          class="mt-1 text-xs text-red-600"
          *ngIf="updateForm.controls['comment'].invalid && updateForm.controls['comment'].touched"
        >
          20–40 caracteres.
        </p>
      </div>

      <div>
        <label class="block text-sm font-medium text-slate-800">Responsable</label>
        <input
          class="mt-1 block w-full rounded-md border-stone-300 shadow-sm focus:border-emerald-600 focus:ring-emerald-600"
          formControlName="responsible"
        />
        <p
          class="mt-1 text-xs text-red-600"
          *ngIf="
            updateForm.controls['responsible'].invalid && updateForm.controls['responsible'].touched
          "
        >
          Solo letras y espacios.
        </p>
      </div>

      <div class="md:col-span-3 flex justify-end gap-3">
        <button
          type="reset"
          class="inline-flex items-center rounded-md border border-emerald-700 text-emerald-800 bg-white hover:bg-stone-100 px-4 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-emerald-700 focus:ring-offset-2"
        >
          Limpiar
        </button>
        <button
          type="submit"
          class="inline-flex items-center rounded-md bg-emerald-700 text-white hover:bg-emerald-800 px-4 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-emerald-600 focus:ring-offset-2"
        >
          Guardar actualización
        </button>
      </div>
    </form>
  </div>
</section>
